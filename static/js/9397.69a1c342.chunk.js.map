{"version":3,"file":"static/js/9397.69a1c342.chunk.js","mappings":"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","sources":["components/ChatWidget.tsx","../node_modules/@ant-design/icons-svg/es/asn/MessageOutlined.js","../node_modules/@ant-design/icons/es/icons/MessageOutlined.js","utils/deviceFingerprint.ts","services/auth.service.ts","pages/MyChatsPage.tsx"],"sourcesContent":["import React, { useEffect, useState, useRef, useCallback } from 'react';\r\nimport { io, Socket } from 'socket.io-client';\r\nimport { Button, Input, List, Spin } from 'antd';\r\nimport { SmileOutlined, PaperClipOutlined, AudioOutlined, ArrowRightOutlined, SendOutlined } from '@ant-design/icons';\r\nimport { refreshToken } from '../services/auth.service';\r\n\r\ninterface Message {\r\n  id: number;\r\n  author?: { id: number; firstName?: string; lastName?: string; photo?: string; avatar?: string };\r\n  authorId?: number;\r\n  text: string;\r\n  createdAt: string;\r\n}\r\n\r\ninterface ChatWidgetProps {\r\n  chatId?: number;\r\n  userId: number;\r\n  jwt: string;\r\n  propertyId: number;\r\n  sellerId?: number;\r\n  buyerId?: number;\r\n  onChatIdResolved?: (chatId: number) => void;\r\n  hideInput?: boolean;\r\n  onlyInput?: boolean;\r\n}\r\n\r\n// Always use backend on port 3001 for API and WebSocket, regardless of frontend port\r\nconst BACKEND_HOST = window.location.hostname;\r\nconst WS_URL = `http://${BACKEND_HOST}:3001`;\r\nconst API_URL = `http://${BACKEND_HOST}:3001/api`;\r\n\r\nconst EMOJI_LIST = ['👍', '😂', '🔥', '😍', '😮', '😢', '👏', '🎉', '💯', '🤔'];\r\n\r\nexport const ChatWidget: React.FC<ChatWidgetProps & { limitLastN?: number }> = ({ chatId: initialChatId, userId, jwt, propertyId, sellerId, buyerId, onChatIdResolved, hideInput, onlyInput, limitLastN }) => {\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [input, setInput] = useState('');\r\n  const [typing, setTyping] = useState(false);\r\n  const [someoneTyping, setSomeoneTyping] = useState(false);\r\n  const socketRef = useRef<Socket | null>(null);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [chatId, setChatId] = useState<number | null>(initialChatId || null);\r\n  const [showEmojiPanel, setShowEmojiPanel] = useState(false);\r\n  const [replyTo, setReplyTo] = useState<Message | null>(null);\r\n  const [reactions, setReactions] = useState<{ [msgId: number]: string[] }>({});\r\n  const scrollableRef = useRef<HTMLDivElement>(null);\r\n\r\n  // --- Новый отказоустойчивый connectSocket ---\r\n  const connectSocket = useCallback(() => {\r\n    const token = localStorage.getItem('token');\r\n    const socket = io(WS_URL, {\r\n      auth: { token },\r\n      transports: ['websocket'],\r\n    });\r\n    socketRef.current = socket;\r\n    socket.on('connect', () => {\r\n      console.log('[ChatWidget] Socket connected', { initialChatId, chatId, userId, token, WS_URL });\r\n    });\r\n    socket.on('disconnect', async (reason) => {\r\n      console.log('[ChatWidget] Socket disconnected:', reason);\r\n      if (\r\n        reason === 'io server disconnect' ||\r\n        (typeof reason === 'string' && reason.includes('jwt expired'))\r\n      ) {\r\n        const newToken = await refreshToken();\r\n        if (newToken) {\r\n          localStorage.setItem('token', newToken);\r\n          connectSocket();\r\n        } else {\r\n          window.location.href = '/login';\r\n        }\r\n      }\r\n    });\r\n    socket.on('connect_error', async (err) => {\r\n      console.error('[ChatWidget] Socket connect_error:', err);\r\n      if (err.message && err.message.includes('jwt expired')) {\r\n        const newToken = await refreshToken();\r\n        if (newToken) {\r\n          localStorage.setItem('token', newToken);\r\n          connectSocket();\r\n        } else {\r\n          window.location.href = '/login';\r\n        }\r\n      }\r\n    });\r\n    // Получаем chatId, если не передан\r\n    if (!initialChatId && propertyId) {\r\n      socket.emit('getOrCreateChat', { propertyId }, (response: { chatId: number }) => {\r\n        if (response && response.chatId) {\r\n          setChatId(response.chatId);\r\n          socket.emit('joinChat', { chatId: response.chatId });\r\n          if (onChatIdResolved) onChatIdResolved(response.chatId);\r\n        }\r\n      });\r\n    } else if (initialChatId) {\r\n      socket.emit('joinChat', { chatId: initialChatId });\r\n    }\r\n    socket.on('receiveMessage', (msg) => {\r\n      setMessages(prev => [...prev, msg]);\r\n    });\r\n    socket.on('typing', ({ userId: typingUserId }) => {\r\n      if (typingUserId !== userId) {\r\n        setSomeoneTyping(true);\r\n        setTimeout(() => setSomeoneTyping(false), 2000);\r\n      }\r\n    });\r\n    return socket;\r\n  }, [initialChatId, chatId, userId, propertyId, onChatIdResolved]);\r\n\r\n  // --- useEffect для сокета ---\r\n  useEffect(() => {\r\n    const socket = connectSocket();\r\n    return () => {\r\n      socket.disconnect();\r\n    };\r\n  }, [connectSocket]);\r\n\r\n  // useEffect для загрузки истории — только когда chatId появился\r\n  useEffect(() => {\r\n    if (chatId) {\r\n      setLoading(true);\r\n      fetch(`${API_URL}/chats/${chatId}/messages`, {\r\n        headers: { Authorization: `Bearer ${jwt}` },\r\n      })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n          setMessages(Array.isArray(data) ? data : []);\r\n        })\r\n        .catch(() => setMessages([]))\r\n        .finally(() => setLoading(false));\r\n    }\r\n  }, [chatId, jwt]);\r\n\r\n  useEffect(() => {\r\n    if (scrollableRef.current) {\r\n      scrollableRef.current.scrollTop = scrollableRef.current.scrollHeight;\r\n    }\r\n  }, [messages]);\r\n\r\n  // Синхронизация chatId с пропсом initialChatId\r\n  useEffect(() => {\r\n    if (initialChatId && initialChatId !== chatId) {\r\n      setChatId(initialChatId);\r\n    }\r\n  }, [initialChatId]);\r\n\r\n  // Сброс сообщений при смене чата/пользователя/объекта\r\n  useEffect(() => {\r\n    setMessages([]);\r\n  }, [chatId, userId, propertyId]);\r\n\r\n  const getToUserId = () => {\r\n    if (sellerId && userId !== sellerId) return sellerId;\r\n    if (buyerId && userId !== buyerId) return buyerId;\r\n    return undefined;\r\n  };\r\n\r\n  const handleSend = useCallback(() => {\r\n    if (!input.trim() || !chatId) return;\r\n    const toUserId = getToUserId();\r\n    console.log('[ChatWidget] Sending message:', input, { chatId, userId, toUserId, jwt, propertyId });\r\n    socketRef.current?.emit('sendMessage', {\r\n      chatId,\r\n      text: input,\r\n      propertyId,\r\n      toUserId,\r\n      authorId: userId,\r\n    });\r\n    setInput('');\r\n    setTyping(false);\r\n    setTimeout(() => {\r\n      console.log('[ChatWidget] Refetching history after send', { chatId, userId, jwt });\r\n      fetch(`${API_URL}/chats/${chatId}/messages`, {\r\n        headers: { Authorization: `Bearer ${jwt}` },\r\n      })\r\n        .then(res => {\r\n          console.log('[ChatWidget] fetch history after send response status:', res.status);\r\n          return res.json();\r\n        })\r\n        .then(data => {\r\n          if (Array.isArray(data)) setMessages(data);\r\n          else setMessages([]);\r\n        })\r\n        .catch((err) => {\r\n          setMessages([]);\r\n          console.error('[ChatWidget] Error fetching history after send:', err);\r\n        });\r\n    }, 200);\r\n  }, [input, chatId, userId, jwt, propertyId, sellerId, buyerId]);\r\n\r\n  const handleInput = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setInput(e.target.value);\r\n    if (!typing) {\r\n      setTyping(true);\r\n      socketRef.current?.emit('typing', { chatId, userId });\r\n      setTimeout(() => setTyping(false), 1500);\r\n    }\r\n  };\r\n\r\n  const handleAddReaction = (msgId: number, emoji: string) => {\r\n    setReactions(prev => {\r\n      const arr = prev[msgId] || [];\r\n      if (arr.includes(emoji)) {\r\n        return { ...prev, [msgId]: arr.filter(e => e !== emoji) };\r\n      } else {\r\n        return { ...prev, [msgId]: [...arr, emoji] };\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleReply = (msg: Message) => {\r\n    setReplyTo(msg);\r\n  };\r\n\r\n  const handleEmojiClick = (emoji: string) => {\r\n    setInput(input + emoji);\r\n    setShowEmojiPanel(false);\r\n  };\r\n\r\n  const visibleMessages = limitLastN && messages.length > limitLastN ? messages.slice(-limitLastN) : messages;\r\n\r\n  if (onlyInput) {\r\n    return (\r\n      <div style={{ display: 'flex', alignItems: 'center', gap: 10, padding: 0, background: '#fff', borderRadius: 0 }}>\r\n        <input\r\n          value={input}\r\n          onChange={handleInput}\r\n          onKeyDown={e => { if (e.key === 'Enter') handleSend(); }}\r\n          placeholder=\"Введите сообщение...\"\r\n          disabled={loading}\r\n          style={{ flex: 1, borderRadius: 16, background: '#fff', border: '1.5px solid #e6eaf1', fontSize: 16, padding: '12px 18px' }}\r\n        />\r\n        <button\r\n          onClick={handleSend}\r\n          disabled={!input.trim() || loading}\r\n          style={{ borderRadius: '50%', background: '#2563eb', color: '#fff', fontWeight: 700, fontSize: 20, width: 44, height: 44, border: 'none', display: 'flex', alignItems: 'center', justifyContent: 'center', boxShadow: 'none', transition: 'background 0.2s' }}\r\n        >\r\n          <SendOutlined />\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={{\r\n      background: 'linear-gradient(135deg, #f8fafc 0%, #e9f0fb 100%)',\r\n      borderRadius: 18,\r\n      boxShadow: '0 8px 32px 0 rgba(31, 38, 135, 0.10)',\r\n      padding: 0,\r\n      minHeight: 440,\r\n      maxHeight: 770,\r\n      height: '100%',\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n      position: 'relative',\r\n      overflow: 'hidden',\r\n      transition: 'none',\r\n      flex: 1,\r\n    }}>\r\n      {/* Основной блок сообщений с нормальными стилями */}\r\n      <div ref={scrollableRef} style={{ flex: '1 1 0%', overflowY: 'auto', minHeight: 0, height: '100%', position: 'relative', padding: '18px 0 8px', background: 'transparent' }}>\r\n        {loading ? (\r\n          <Spin style={{ margin: '40px auto', display: 'block' }} />\r\n        ) : visibleMessages.length === 0 ? (\r\n          <div style={{\r\n            color: '#bbb',\r\n            fontSize: 20,\r\n            position: 'absolute',\r\n            top: 0,\r\n            left: 0,\r\n            width: '100%',\r\n            height: '100%',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            pointerEvents: 'none',\r\n            zIndex: 1,\r\n          }}>Нет сообщений</div>\r\n        ) : (\r\n          visibleMessages.map(msg => {\r\n            // Fallback: если нет author, но есть authorId\r\n            const author = msg.author || (msg.authorId ? { id: msg.authorId } : undefined);\r\n            const isMe = author?.id === userId;\r\n            return (\r\n              <div key={msg.id} style={{\r\n                display: 'flex',\r\n                flexDirection: isMe ? 'row-reverse' : 'row',\r\n                alignItems: 'flex-end',\r\n                margin: '14px 0',\r\n                padding: '0 24px',\r\n                animation: 'fadeInUp 0.4s',\r\n              }}>\r\n                {/* Аватар автора сообщения */}\r\n                {(() => {\r\n                  let authorAvatar = author?.photo || author?.avatar || undefined;\r\n                  // Не подставлять /avatars/ и не заменять на /thumbnails/ — использовать путь как есть\r\n                  return (\r\n                    <div style={{ minWidth: 42, minHeight: 42, margin: isMe ? '0 0 0 14px' : '0 14px 0 0' }}>\r\n                      <img\r\n                        src={authorAvatar}\r\n                        alt={author?.firstName || '?'}\r\n                        style={{ width: 42, height: 42, borderRadius: '50%', objectFit: 'cover', background: '#f2f3f5', display: authorAvatar ? 'block' : 'none', boxShadow: '0 2px 8px #e6eaf1' }}\r\n                        onError={e => { (e.target as HTMLImageElement).style.display = 'none'; }}\r\n                      />\r\n                      {!authorAvatar && (\r\n                        <div style={{\r\n                          width: 42,\r\n                          height: 42,\r\n                          borderRadius: '50%',\r\n                          background: '#e6eaf1',\r\n                          display: 'flex',\r\n                          alignItems: 'center',\r\n                          justifyContent: 'center',\r\n                          fontWeight: 700,\r\n                          color: '#bbb',\r\n                          fontSize: 18,\r\n                          boxShadow: '0 2px 8px #e6eaf1',\r\n                        }}>\r\n                          {author?.firstName ? author.firstName[0] : '?'}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  );\r\n                })()}\r\n                <div style={{\r\n                  maxWidth: 480,\r\n                  background: isMe ? 'linear-gradient(135deg, #2563eb 0%, #3b82f6 100%)' : 'linear-gradient(135deg, #fff 0%, #f2f3f5 100%)',\r\n                  color: isMe ? '#fff' : '#222',\r\n                  borderRadius: isMe ? '22px 22px 8px 22px' : '22px 22px 22px 8px',\r\n                  padding: '16px 22px 12px 22px',\r\n                  fontSize: 16,\r\n                  fontWeight: 400,\r\n                  wordBreak: 'break-word',\r\n                  marginLeft: isMe ? 0 : 0,\r\n                  marginRight: isMe ? 0 : 0,\r\n                  boxShadow: '0 2px 16px #e6eaf1',\r\n                  position: 'relative',\r\n                  display: 'flex',\r\n                  flexDirection: 'column',\r\n                  minHeight: 52,\r\n                  justifyContent: 'flex-end',\r\n                  transition: 'background 0.2s',\r\n                }}>\r\n                  <span style={{ display: 'block', marginBottom: 6, whiteSpace: 'pre-line' }}>{msg.text}</span>\r\n                  <span style={{ fontSize: 13, color: isMe ? '#dbeafe' : '#888', textAlign: 'right', alignSelf: 'flex-end', lineHeight: 1, marginTop: 2 }}>{new Date(msg.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>\r\n                </div>\r\n              </div>\r\n            );\r\n          })\r\n        )}\r\n        <div ref={messagesEndRef} />\r\n        {someoneTyping && <div style={{ color: '#1976d2', fontSize: 15, margin: '8px 0 0 28px' }}>Печатает...</div>}\r\n      </div>\r\n      {!onlyInput && !hideInput && (\r\n        <div style={{\r\n          display: 'flex',\r\n          alignItems: 'center',\r\n          gap: 10,\r\n          padding: '14px 18px 14px 10px',\r\n          background: '#f7f9fc',\r\n          borderRadius: 18,\r\n          position: 'absolute',\r\n          left: 0,\r\n          right: 0,\r\n          bottom: 0,\r\n          zIndex: 2,\r\n          boxShadow: '0 -2px 16px #e6eaf1',\r\n          width: '100%',\r\n        }}>\r\n          <input\r\n            value={input}\r\n            onChange={handleInput}\r\n            onKeyDown={e => { if (e.key === 'Enter') handleSend(); }}\r\n            placeholder=\"Введите сообщение...\"\r\n            disabled={loading}\r\n            style={{ flex: '1 1 0%', borderRadius: 16, background: '#fff', border: '1.5px solid #e6eaf1', fontSize: 17, padding: '14px 20px', boxShadow: '0 2px 8px #e6eaf1', outline: 'none', transition: 'border 0.2s' }}\r\n          />\r\n          <button\r\n            onClick={handleSend}\r\n            disabled={!input.trim() || loading}\r\n            style={{ borderRadius: '50%', background: 'linear-gradient(135deg, #2563eb 0%, #3b82f6 100%)', color: '#fff', fontWeight: 700, fontSize: 22, width: 48, height: 48, border: 'none', display: 'flex', alignItems: 'center', justifyContent: 'center', boxShadow: '0 2px 8px #e6eaf1', transition: 'background 0.2s' }}\r\n          >\r\n            <SendOutlined />\r\n          </button>\r\n        </div>\r\n      )}\r\n      <style>{`\r\n        @keyframes fadeInUp {\r\n          from { opacity: 0; transform: translate3d(0, 40px, 0); }\r\n          to { opacity: 1; transform: none; }\r\n        }\r\n        @media (max-width: 767px) {\r\n          .ant-spin {\r\n            margin: 24px auto !important;\r\n          }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}; ","// This icon file is generated automatically.\nvar MessageOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M464 512a48 48 0 1096 0 48 48 0 10-96 0zm200 0a48 48 0 1096 0 48 48 0 10-96 0zm-400 0a48 48 0 1096 0 48 48 0 10-96 0zm661.2-173.6c-22.6-53.7-55-101.9-96.3-143.3a444.35 444.35 0 00-143.3-96.3C630.6 75.7 572.2 64 512 64h-2c-60.6.3-119.3 12.3-174.5 35.9a445.35 445.35 0 00-142 96.5c-40.9 41.3-73 89.3-95.2 142.8-23 55.4-34.6 114.3-34.3 174.9A449.4 449.4 0 00112 714v152a46 46 0 0046 46h152.1A449.4 449.4 0 00510 960h2.1c59.9 0 118-11.6 172.7-34.3a444.48 444.48 0 00142.8-95.2c41.3-40.9 73.8-88.7 96.5-142 23.6-55.2 35.6-113.9 35.9-174.5.3-60.9-11.5-120-34.8-175.6zm-151.1 438C704 845.8 611 884 512 884h-1.7c-60.3-.3-120.2-15.3-173.1-43.5l-8.4-4.5H188V695.2l-4.5-8.4C155.3 633.9 140.3 574 140 513.7c-.4-99.7 37.7-193.3 107.6-263.8 69.8-70.5 163.1-109.5 262.8-109.9h1.7c50 0 98.5 9.7 144.2 28.9 44.6 18.7 84.6 45.6 119 80 34.3 34.3 61.3 74.4 80 119 19.4 46.2 29.1 95.2 28.9 145.8-.6 99.6-39.7 192.9-110.1 262.7z\" } }] }, \"name\": \"message\", \"theme\": \"outlined\" };\nexport default MessageOutlined;\n","function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\n\nimport * as React from 'react';\nimport MessageOutlinedSvg from \"@ant-design/icons-svg/es/asn/MessageOutlined\";\nimport AntdIcon from \"../components/AntdIcon\";\nconst MessageOutlined = (props, ref) => /*#__PURE__*/React.createElement(AntdIcon, _extends({}, props, {\n  ref: ref,\n  icon: MessageOutlinedSvg\n}));\n\n/**![message](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIGZpbGw9IiNjYWNhY2EiIHZpZXdCb3g9IjY0IDY0IDg5NiA4OTYiIGZvY3VzYWJsZT0iZmFsc2UiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQ2NCA1MTJhNDggNDggMCAxMDk2IDAgNDggNDggMCAxMC05NiAwem0yMDAgMGE0OCA0OCAwIDEwOTYgMCA0OCA0OCAwIDEwLTk2IDB6bS00MDAgMGE0OCA0OCAwIDEwOTYgMCA0OCA0OCAwIDEwLTk2IDB6bTY2MS4yLTE3My42Yy0yMi42LTUzLjctNTUtMTAxLjktOTYuMy0xNDMuM2E0NDQuMzUgNDQ0LjM1IDAgMDAtMTQzLjMtOTYuM0M2MzAuNiA3NS43IDU3Mi4yIDY0IDUxMiA2NGgtMmMtNjAuNi4zLTExOS4zIDEyLjMtMTc0LjUgMzUuOWE0NDUuMzUgNDQ1LjM1IDAgMDAtMTQyIDk2LjVjLTQwLjkgNDEuMy03MyA4OS4zLTk1LjIgMTQyLjgtMjMgNTUuNC0zNC42IDExNC4zLTM0LjMgMTc0LjlBNDQ5LjQgNDQ5LjQgMCAwMDExMiA3MTR2MTUyYTQ2IDQ2IDAgMDA0NiA0NmgxNTIuMUE0NDkuNCA0NDkuNCAwIDAwNTEwIDk2MGgyLjFjNTkuOSAwIDExOC0xMS42IDE3Mi43LTM0LjNhNDQ0LjQ4IDQ0NC40OCAwIDAwMTQyLjgtOTUuMmM0MS4zLTQwLjkgNzMuOC04OC43IDk2LjUtMTQyIDIzLjYtNTUuMiAzNS42LTExMy45IDM1LjktMTc0LjUuMy02MC45LTExLjUtMTIwLTM0LjgtMTc1LjZ6bS0xNTEuMSA0MzhDNzA0IDg0NS44IDYxMSA4ODQgNTEyIDg4NGgtMS43Yy02MC4zLS4zLTEyMC4yLTE1LjMtMTczLjEtNDMuNWwtOC40LTQuNUgxODhWNjk1LjJsLTQuNS04LjRDMTU1LjMgNjMzLjkgMTQwLjMgNTc0IDE0MCA1MTMuN2MtLjQtOTkuNyAzNy43LTE5My4zIDEwNy42LTI2My44IDY5LjgtNzAuNSAxNjMuMS0xMDkuNSAyNjIuOC0xMDkuOWgxLjdjNTAgMCA5OC41IDkuNyAxNDQuMiAyOC45IDQ0LjYgMTguNyA4NC42IDQ1LjYgMTE5IDgwIDM0LjMgMzQuMyA2MS4zIDc0LjQgODAgMTE5IDE5LjQgNDYuMiAyOS4xIDk1LjIgMjguOSAxNDUuOC0uNiA5OS42LTM5LjcgMTkyLjktMTEwLjEgMjYyLjd6IiAvPjwvc3ZnPg==) */\nconst RefIcon = /*#__PURE__*/React.forwardRef(MessageOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'MessageOutlined';\n}\nexport default RefIcon;","import * as crypto from 'crypto';\r\n\r\nexport interface DeviceInfo {\r\n  deviceId: string;\r\n  deviceFingerprint: string;\r\n  userAgent: string;\r\n  screenResolution: string;\r\n  timezone: string;\r\n  language: string;\r\n  ipAddress?: string;\r\n  location?: string;\r\n  deviceType?: string;\r\n  browser?: string;\r\n  browserVersion?: string;\r\n}\r\n\r\n/**\r\n * Генерация уникального ID устройства\r\n */\r\nexport function generateDeviceId(): string {\r\n  const userAgent = navigator.userAgent;\r\n  const platform = navigator.platform;\r\n  const language = navigator.language;\r\n  const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\r\n  \r\n  // Используем более стабильные характеристики устройства\r\n  const data = `${platform}-${language}-${timezone}-${Date.now()}`;\r\n  \r\n  // Простой хеш\r\n  let hash = 0;\r\n  for (let i = 0; i < data.length; i++) {\r\n    const char = data.charCodeAt(i);\r\n    hash = ((hash << 5) - hash) + char;\r\n    hash = hash & hash; // Convert to 32bit integer\r\n  }\r\n  return Math.abs(hash).toString(36);\r\n}\r\n\r\n/**\r\n * Генерация fingerprint устройства с учетом браузера\r\n */\r\nexport function generateDeviceFingerprint(): string {\r\n  const userAgent = navigator.userAgent;\r\n  const platform = navigator.platform;\r\n  const language = navigator.language;\r\n  const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\r\n  \r\n  // Определяем тип браузера\r\n  const browserInfo = getBrowserInfo();\r\n  \r\n  const data = `${platform}-${language}-${timezone}-${browserInfo.browser}-${browserInfo.version}`;\r\n  \r\n  let hash = 0;\r\n  for (let i = 0; i < data.length; i++) {\r\n    const char = data.charCodeAt(i);\r\n    hash = ((hash << 5) - hash) + char;\r\n    hash = hash & hash;\r\n  }\r\n  return Math.abs(hash).toString(36);\r\n}\r\n\r\n/**\r\n * Определение информации о браузере\r\n */\r\nfunction getBrowserInfo(): { browser: string; version: string } {\r\n  const userAgent = navigator.userAgent;\r\n  \r\n  if (userAgent.includes('Chrome')) {\r\n    return { browser: 'Chrome', version: getVersion(userAgent, 'Chrome') };\r\n  } else if (userAgent.includes('Firefox')) {\r\n    return { browser: 'Firefox', version: getVersion(userAgent, 'Firefox') };\r\n  } else if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) {\r\n    return { browser: 'Safari', version: getVersion(userAgent, 'Safari') };\r\n  } else if (userAgent.includes('Edge')) {\r\n    return { browser: 'Edge', version: getVersion(userAgent, 'Edge') };\r\n  } else if (userAgent.includes('Opera')) {\r\n    return { browser: 'Opera', version: getVersion(userAgent, 'Opera') };\r\n  } else {\r\n    return { browser: 'Unknown', version: 'Unknown' };\r\n  }\r\n}\r\n\r\n/**\r\n * Извлечение версии браузера\r\n */\r\nfunction getVersion(userAgent: string, browserName: string): string {\r\n  const match = userAgent.match(new RegExp(`${browserName}/([\\\\d.]+)`));\r\n  return match ? match[1] : 'Unknown';\r\n}\r\n\r\n/**\r\n * Определение типа устройства\r\n */\r\nfunction getDeviceType(): string {\r\n  const userAgent = navigator.userAgent;\r\n  \r\n  if (/Mobile|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)) {\r\n    return 'mobile';\r\n  } else if (/Tablet|iPad/i.test(userAgent)) {\r\n    return 'tablet';\r\n  } else {\r\n    return 'desktop';\r\n  }\r\n}\r\n\r\n/**\r\n * Получение информации об устройстве\r\n */\r\nexport function getDeviceInfo(): DeviceInfo {\r\n  const userAgent = navigator.userAgent;\r\n  const platform = navigator.platform;\r\n  const language = navigator.language;\r\n  const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\r\n  const deviceType = getDeviceType();\r\n  const browserInfo = getBrowserInfo();\r\n  \r\n  return {\r\n    deviceId: generateDeviceId(),\r\n    deviceFingerprint: generateDeviceFingerprint(),\r\n    userAgent,\r\n    screenResolution: 'unknown',\r\n    timezone,\r\n    language,\r\n    deviceType,\r\n    browser: browserInfo.browser,\r\n    browserVersion: browserInfo.version,\r\n  };\r\n}\r\n\r\n/**\r\n * Получение IP адреса (через внешний сервис)\r\n */\r\nexport async function getIpAddress(): Promise<string> {\r\n  try {\r\n    const response = await fetch('https://api.ipify.org?format=json');\r\n    const data = await response.json();\r\n    return data.ip;\r\n  } catch (error) {\r\n    console.warn('Не удалось получить IP адрес:', error);\r\n    return 'unknown';\r\n  }\r\n}\r\n\r\n/**\r\n * Получение геолокации (город/страна)\r\n */\r\nexport async function getLocation(): Promise<string> {\r\n  try {\r\n    const response = await fetch('https://ipapi.co/json/');\r\n    const data = await response.json();\r\n    return `${data.city}, ${data.country_name}`;\r\n  } catch (error) {\r\n    console.warn('Не удалось получить геолокацию:', error);\r\n    return 'unknown';\r\n  }\r\n}\r\n\r\n/**\r\n * Получение полной информации об устройстве\r\n */\r\nexport async function getFullDeviceInfo(): Promise<DeviceInfo> {\r\n  const baseInfo = getDeviceInfo();\r\n  const [ipAddress, location] = await Promise.all([\r\n    getIpAddress(),\r\n    getLocation(),\r\n  ]);\r\n  \r\n  return {\r\n    ...baseInfo,\r\n    ipAddress,\r\n    location,\r\n  };\r\n} ","import api from './api';\r\nimport { LoginCredentials, User } from '../types';\r\nimport { getFullDeviceInfo, DeviceInfo } from '../utils/deviceFingerprint';\r\n\r\n// Временные типы для восстановления пароля\r\ninterface ForgotPasswordRequest {\r\n  email: string;\r\n}\r\n\r\ninterface ResetPasswordRequest {\r\n  token: string;\r\n  newPassword: string;\r\n}\r\n\r\ninterface ForgotPasswordResponse {\r\n  message: string;\r\n}\r\n\r\ninterface ResetPasswordResponse {\r\n  message: string;\r\n}\r\n\r\nexport const login = async (credentials: LoginCredentials, config?: any): Promise<{ access_token: string; user: User }> => {\r\n  try {\r\n    // Получаем информацию об устройстве\r\n    const deviceInfo = await getFullDeviceInfo();\r\n    \r\n    const response = await api.post('/api/auth/login', {\r\n      ...credentials,\r\n      deviceInfo,\r\n    }, config);\r\n    return response.data;\r\n  } catch (error) {\r\n    // Если не удалось получить информацию об устройстве, отправляем без неё\r\n    const response = await api.post('/api/auth/login', credentials, config);\r\n    return response.data;\r\n  }\r\n};\r\n\r\nexport const register = async (formData: FormData): Promise<any> => {\r\n  const response = await api.post('/api/auth/register', formData, {\r\n    headers: {\r\n      'Content-Type': 'multipart/form-data',\r\n    },\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const updateProfile = async (userData: Partial<User>): Promise<User> => {\r\n  const response = await api.patch('/api/users/profile', userData);\r\n  return response.data;\r\n};\r\n\r\nexport const updateUser = async (id: number, userData: Partial<User>): Promise<User> => {\r\n  const response = await api.patch(`/api/users/${id}`, userData);\r\n  return response.data;\r\n};\r\n\r\nexport const getProfile = async (token?: string): Promise<User> => {\r\n  const response = await api.get('/api/users/profile', {\r\n    headers: token ? { Authorization: `Bearer ${token}` } : undefined,\r\n  });\r\n  return response.data;\r\n};\r\n\r\n// Получить новый access_token по refresh_token (cookie)\r\nexport async function refreshToken(): Promise<string | null> {\r\n  try {\r\n    const res = await fetch('/api/auth/refresh', {\r\n      method: 'POST',\r\n      credentials: 'include', // чтобы отправлялись cookies\r\n    });\r\n    if (!res.ok) return null;\r\n    const data = await res.json();\r\n    return data.access_token || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n// Запрос на восстановление пароля\r\nexport const forgotPassword = async (email: string): Promise<ForgotPasswordResponse> => {\r\n  const response = await api.post<ForgotPasswordResponse>('/api/auth/forgot-password', { email });\r\n  return response.data;\r\n};\r\n\r\n// Сброс пароля по токену\r\nexport const resetPassword = async (token: string, newPassword: string): Promise<ResetPasswordResponse> => {\r\n  const response = await api.post<ResetPasswordResponse>('/api/auth/reset-password', { \r\n    token, \r\n    newPassword \r\n  });\r\n  return response.data;\r\n}; ","import React, { useContext, useEffect, useState, useMemo } from 'react';\r\nimport { AuthContext } from '../context/AuthContext';\r\nimport { ChatWidget } from '../components/ChatWidget';\r\nimport { List, Avatar, Input, Spin, Alert, Badge, Typography, Tag } from 'antd';\r\nimport { MessageOutlined, HomeOutlined, PropertySafetyOutlined } from '@ant-design/icons';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\n\r\nconst { Title } = Typography;\r\n\r\n// Функция для нормализации массива фото объекта\r\nfunction normalizePhotos(photos: any): string[] {\r\n  if (Array.isArray(photos)) return photos;\r\n  if (typeof photos === 'string') {\r\n    try {\r\n      const arr = JSON.parse(photos);\r\n      return Array.isArray(arr) ? arr : [];\r\n    } catch {\r\n      return [];\r\n    }\r\n  }\r\n  return [];\r\n}\r\n\r\nconst MyChatsPage: React.FC = () => {\r\n  const auth = useContext(AuthContext);\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const [chats, setChats] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedChat, setSelectedChat] = useState<any | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [search, setSearch] = useState('');\r\n\r\n  const BACKEND_HOST = window.location.hostname;\r\n  const API_URL = `http://${BACKEND_HOST}:3001/api`;\r\n\r\n  useEffect(() => {\r\n    if (!auth?.token) return;\r\n    setLoading(true);\r\n    fetch(`${API_URL}/chats`, {\r\n      headers: { Authorization: `Bearer ${auth.token}` },\r\n    })\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        setChats(Array.isArray(data) ? data : []);\r\n        setError(null);\r\n      })\r\n      .catch(() => {\r\n        setChats([]);\r\n        setError('Ошибка загрузки чатов');\r\n      })\r\n      .finally(() => setLoading(false));\r\n  }, [auth?.token]);\r\n\r\n  // Открытие чата по параметрам (propertyId, agentId)\r\n  useEffect(() => {\r\n    if (!auth || !auth.token) return;\r\n    const params = new URLSearchParams(location.search);\r\n    const propertyId = params.get('propertyId');\r\n    const agentId = params.get('agentId');\r\n    if (propertyId && agentId && chats.length > 0) {\r\n      const found = chats.find(chat =>\r\n        String(chat.property?.id) === String(propertyId) &&\r\n        String(chat.seller?.id) === String(agentId)\r\n      );\r\n      if (found) {\r\n        setSelectedChat(found);\r\n        navigate('/my-chats', { replace: true });\r\n      }\r\n    }\r\n  }, [location.search, chats, auth, navigate]);\r\n\r\n  const filteredChats = useMemo(() => chats.filter(chat => {\r\n    const query = search.toLowerCase();\r\n    return (\r\n      chat.property?.title?.toLowerCase().includes(query) ||\r\n      chat.property?.address?.toLowerCase().includes(query) ||\r\n      chat.seller?.firstName?.toLowerCase().includes(query) ||\r\n      chat.buyer?.firstName?.toLowerCase().includes(query)\r\n    );\r\n  }), [chats, search]);\r\n\r\n  const sortedChats = useMemo(() => {\r\n    const byTime = (a: any, b: any) => {\r\n      const aTime = new Date(a.lastMessage?.createdAt || a.createdAt).getTime();\r\n      const bTime = new Date(b.lastMessage?.createdAt || b.createdAt).getTime();\r\n      return bTime - aTime;\r\n    };\r\n    const unread = filteredChats.filter((c: any) => (c.unreadCount ?? 0) > 0).sort(byTime);\r\n    const read = filteredChats.filter((c: any) => !(c.unreadCount ?? 0)).sort(byTime);\r\n    return [...unread, ...read];\r\n  }, [filteredChats]);\r\n\r\n  if (!auth?.user) return <div>Требуется авторизация</div>;\r\n\r\n  // Debug-вывод параметров выбранного чата\r\n  if (selectedChat && auth?.user && auth.token) {\r\n    console.log('[MyChatsPage] ChatWidget params:', {\r\n      chatId: selectedChat.id,\r\n      userId: auth.user.id,\r\n      jwt: auth.token,\r\n      propertyId: selectedChat.property?.id,\r\n      sellerId: selectedChat.seller?.id,\r\n      buyerId: selectedChat.buyer?.id,\r\n    });\r\n  }\r\n\r\n  return (\r\n    <div style={{ display: 'flex', height: 'calc(100vh - 40px)', background: '#f8fafc', minHeight: 600 }}>\r\n      {/* Список чатов */}\r\n      <div style={{ width: 370, background: '#fff', borderRadius: 18, boxShadow: '0 4px 24px #e6eaf1', margin: '32px 0 32px 32px', padding: 0, display: 'flex', flexDirection: 'column', minWidth: 0 }}>\r\n        <div style={{ padding: '28px 28px 12px 28px', borderBottom: '1px solid #f0f0f0' }}>\r\n          <Title level={2} style={{ margin: 0, fontSize: 28, fontWeight: 800, letterSpacing: -1 }}>Чаты</Title>\r\n          <Input.Search\r\n            placeholder=\"Поиск чатов...\"\r\n            value={search}\r\n            onChange={e => setSearch(e.target.value)}\r\n            style={{ marginTop: 18, borderRadius: 8, fontSize: 16, padding: '10px 16px' }}\r\n            allowClear\r\n          />\r\n        </div>\r\n        <div style={{ flex: 1, overflowY: 'auto', padding: '0 0 12px 0' }}>\r\n          <Spin spinning={loading}>\r\n            {error && <Alert type=\"error\" message={error} style={{ margin: 12 }} />}\r\n            {!loading && sortedChats.length === 0 && !error && (\r\n              <Alert type=\"info\" message=\"У вас пока нет чатов\" style={{ margin: 12 }} />\r\n            )}\r\n            <List\r\n              itemLayout=\"horizontal\"\r\n              dataSource={sortedChats}\r\n              style={{ border: 'none', background: 'transparent', padding: 0 }}\r\n              renderItem={chat => {\r\n                // Миниатюра объекта недвижимости (универсальная обработка)\r\n                const images = normalizePhotos(chat.property?.photos);\r\n                let propertyPhoto = images[0];\r\n                if (propertyPhoto) {\r\n                  if (propertyPhoto.startsWith('/uploads/objects/')) {\r\n                    propertyPhoto = propertyPhoto.replace('/uploads/objects/', '/uploads/objects/thumbnails/');\r\n                  } else {\r\n                    propertyPhoto = `/uploads/objects/thumbnails/${propertyPhoto}`;\r\n                  }\r\n                } else {\r\n                  propertyPhoto = '/placeholder-property.jpg';\r\n                }\r\n                return (\r\n                  <List.Item\r\n                    key={chat.id}\r\n                    style={{ cursor: 'pointer', padding: '16px 10px', borderBottom: '1px solid #f0f0f0', background: selectedChat?.id === chat.id ? '#f5f7fa' : undefined, transition: 'background 0.2s', minHeight: 56, borderRadius: 10, marginBottom: 0 }}\r\n                    onClick={() => setSelectedChat(chat)}\r\n                  >\r\n                    <List.Item.Meta\r\n                      avatar={\r\n                        <Avatar size={38} src={propertyPhoto} style={{ background: '#e6eaf1', border: '2px solid #fff', objectFit: 'cover' }} />\r\n                      }\r\n                      title={\r\n                        <div style={{ fontWeight: 700, fontSize: 16, whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis', maxWidth: 180 }}>\r\n                          {chat.property?.title || 'Без названия'}\r\n                        </div>\r\n                      }\r\n                      description={\r\n                        <div style={{ fontSize: 14, color: '#555', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis', maxWidth: 180 }}>\r\n                          {chat.property?.address || ''}\r\n                        </div>\r\n                      }\r\n                    />\r\n                  </List.Item>\r\n                );\r\n              }}\r\n            />\r\n          </Spin>\r\n        </div>\r\n      </div>\r\n      {/* Окно чата */}\r\n      <div style={{ flex: 1, minWidth: 0, display: 'flex', flexDirection: 'column', margin: '32px 32px 32px 0', background: '#fff', borderRadius: 18, boxShadow: '0 4px 24px #e6eaf1', overflow: 'hidden', minHeight: 0 }}>\r\n        {selectedChat ? (\r\n          <div style={{ flex: 1, display: 'flex', flexDirection: 'column', minHeight: 0 }}>\r\n            {/* Шапка чата */}\r\n            <div style={{\r\n              background: '#f9fafb',\r\n              borderRadius: '18px 18px 0 0',\r\n              minHeight: 56,\r\n              padding: '18px 32px 10px 32px',\r\n              borderBottom: '1.5px solid #e6eaf1',\r\n              marginBottom: 0,\r\n              boxShadow: '0 2px 8px #e6eaf1',\r\n              display: 'flex',\r\n              flexDirection: 'column',\r\n              gap: 2,\r\n            }}>\r\n              <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', gap: 12 }}>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\r\n                  {/* Миниатюра аватара продавца (seller) */}\r\n                  {(() => {\r\n                    let sellerAvatar = selectedChat.seller?.photo || selectedChat.seller?.avatar || undefined;\r\n                    // Не подставлять /avatars/ и не заменять на /thumbnails/ — использовать путь как есть\r\n                    return (\r\n                      <Avatar size={34} src={sellerAvatar} style={{ background: '#f2f3f5', fontWeight: 700, flexShrink: 0, objectFit: 'cover' }}>\r\n                        {(!sellerAvatar && selectedChat.seller?.firstName) ? selectedChat.seller.firstName[0] : 'A'}\r\n                      </Avatar>\r\n                    );\r\n                  })()}\r\n                  <span style={{ fontWeight: 700, fontSize: 16, color: '#222' }}>{selectedChat.seller?.lastName} {selectedChat.seller?.firstName}</span>\r\n                </div>\r\n                {/* Статус объекта */}\r\n                {selectedChat.property?.status && (\r\n                  <Tag color={\r\n                    selectedChat.property.status === 'for_sale' ? 'green' :\r\n                    selectedChat.property.status === 'in_deal' ? 'orange' :\r\n                    selectedChat.property.status === 'reserved' ? 'blue' :\r\n                    selectedChat.property.status === 'sold' ? 'red' : 'default'\r\n                  } style={{ fontWeight: 600, fontSize: 15, padding: '2px 16px', borderRadius: 8, margin: '0 auto' }}>\r\n                    {selectedChat.property.status === 'for_sale' ? 'В продаже' :\r\n                     selectedChat.property.status === 'in_deal' ? 'На задатке' :\r\n                     selectedChat.property.status === 'reserved' ? 'На брони' :\r\n                     selectedChat.property.status === 'sold' ? 'Продан' : selectedChat.property.status}\r\n                  </Tag>\r\n                )}\r\n                <div style={{ fontWeight: 600, fontSize: 16, color: '#2563eb', maxWidth: 340, textAlign: 'right', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>\r\n                  <a\r\n                    href={selectedChat.property?.id ? `/properties/${selectedChat.property.id}` : '#'}\r\n                    style={{ color: '#2563eb', fontWeight: 700, fontSize: 16, textDecoration: 'none', transition: 'color 0.2s', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}\r\n                    onClick={e => {\r\n                      if (!selectedChat.property?.id) e.preventDefault();\r\n                    }}\r\n                  >\r\n                    {selectedChat.property?.title}\r\n                  </a>\r\n                </div>\r\n              </div>\r\n              <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', gap: 12, marginTop: 2 }}>\r\n                <div style={{ color: '#2563eb', fontSize: 15, fontWeight: 500 }}>\r\n                  {selectedChat.seller?.phone && (\r\n                    <a href={`tel:${selectedChat.seller.phone}`} style={{ color: '#2563eb', fontSize: 15, textDecoration: 'none', fontWeight: 500 }} title=\"Позвонить\">\r\n                      {selectedChat.seller.phone}\r\n                    </a>\r\n                  )}\r\n                </div>\r\n                {/* Юридическая чистота */}\r\n                {selectedChat.property?.legalCheck && (\r\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 6, background: '#f4f6fa', borderRadius: 8, padding: '2px 12px', fontSize: 14, fontWeight: 600, color: selectedChat.property.legalCheck.status === 'Проверено' ? '#52c41a' : '#faad14' }}>\r\n                    <PropertySafetyOutlined style={{ fontSize: 18, color: selectedChat.property.legalCheck.status === 'Проверено' ? '#52c41a' : '#faad14' }} />\r\n                    <span>{selectedChat.property.legalCheck.status}</span>\r\n                  </div>\r\n                )}\r\n                <div style={{ color: '#6b7280', fontSize: 15, textAlign: 'right', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis', maxWidth: 340 }}>\r\n                  {selectedChat.property?.address}\r\n                </div>\r\n              </div>\r\n            </div>\r\n            {/* ChatWidget с debug-выводом */}\r\n            <div style={{ flex: 1, minHeight: 0, display: 'flex', flexDirection: 'column' }}>\r\n              {auth.user && auth.token && (\r\n                <ChatWidget\r\n                  chatId={selectedChat.id}\r\n                  userId={auth.user.id}\r\n                  jwt={auth.token}\r\n                  propertyId={selectedChat.property?.id}\r\n                  sellerId={selectedChat.seller?.id}\r\n                  buyerId={selectedChat.buyer?.id}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div style={{ textAlign: 'center', color: '#bbb', marginTop: 120 }}>\r\n            <MessageOutlined style={{ fontSize: 64, marginBottom: 24 }} />\r\n            <div style={{ fontSize: 22, fontWeight: 500, marginBottom: 8 }}>Выберите чат слева, чтобы начать общение</div>\r\n            <div style={{ fontSize: 16 }}>Здесь появится история переписки и форма для отправки сообщений</div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MyChatsPage; "],"names":["BACKEND_HOST","window","location","hostname","WS_URL","API_URL","ChatWidget","_ref","chatId","initialChatId","userId","jwt","propertyId","sellerId","buyerId","onChatIdResolved","hideInput","onlyInput","limitLastN","messages","setMessages","useState","input","setInput","typing","setTyping","someoneTyping","setSomeoneTyping","socketRef","useRef","messagesEndRef","loading","setLoading","setChatId","showEmojiPanel","setShowEmojiPanel","replyTo","setReplyTo","reactions","setReactions","scrollableRef","connectSocket","useCallback","token","localStorage","getItem","socket","io","auth","transports","current","on","console","log","async","reason","includes","newToken","refreshToken","setItem","href","error","err","message","emit","response","msg","prev","_ref2","typingUserId","setTimeout","useEffect","disconnect","fetch","headers","Authorization","then","res","json","data","Array","isArray","catch","finally","scrollTop","scrollHeight","handleSend","_socketRef$current","trim","toUserId","text","authorId","status","handleInput","e","_socketRef$current2","target","value","visibleMessages","length","slice","_jsxs","style","display","alignItems","gap","padding","background","borderRadius","children","_jsx","onChange","onKeyDown","key","placeholder","disabled","flex","border","fontSize","onClick","color","fontWeight","width","height","justifyContent","boxShadow","transition","SendOutlined","minHeight","maxHeight","flexDirection","position","overflow","ref","overflowY","_Spin","margin","top","left","pointerEvents","zIndex","map","author","id","undefined","isMe","animation","authorAvatar","photo","avatar","minWidth","src","alt","firstName","objectFit","onError","maxWidth","wordBreak","marginLeft","marginRight","marginBottom","whiteSpace","textAlign","alignSelf","lineHeight","marginTop","Date","createdAt","toLocaleTimeString","hour","minute","right","bottom","outline","_extends","Object","assign","bind","i","arguments","source","prototype","hasOwnProperty","call","apply","this","MessageOutlined","props","React","AntdIcon","icon","MessageOutlinedSvg","generateDeviceId","navigator","userAgent","platform","language","Intl","DateTimeFormat","resolvedOptions","timeZone","now","hash","charCodeAt","Math","abs","toString","generateDeviceFingerprint","timezone","browserInfo","getBrowserInfo","browser","version","getVersion","browserName","match","RegExp","getDeviceInfo","deviceType","test","getDeviceType","deviceId","deviceFingerprint","screenResolution","browserVersion","getIpAddress","ip","warn","getLocation","city","country_name","login","credentials","config","deviceInfo","baseInfo","ipAddress","Promise","all","getFullDeviceInfo","api","post","register","formData","updateProfile","patch","userData","getProfile","get","method","ok","access_token","forgotPassword","email","resetPassword","newPassword","Title","_Typography","MyChatsPage","_selectedChat$seller5","_selectedChat$seller6","_selectedChat$propert2","_selectedChat$propert3","_selectedChat$propert5","_selectedChat$seller7","_selectedChat$propert6","_selectedChat$propert7","_selectedChat$propert8","_selectedChat$seller8","_selectedChat$buyer2","useContext","AuthContext","useLocation","navigate","useNavigate","chats","setChats","selectedChat","setSelectedChat","setError","search","setSearch","params","URLSearchParams","agentId","found","find","chat","_chat$property","_chat$seller","String","property","seller","replace","filteredChats","useMemo","filter","_chat$property2","_chat$property2$title","_chat$property3","_chat$property3$addre","_chat$seller2","_chat$seller2$firstNa","_chat$buyer","_chat$buyer$firstName","query","toLowerCase","title","address","buyer","sortedChats","byTime","a","b","_a$lastMessage","_b$lastMessage","aTime","lastMessage","getTime","c","_c$unreadCount","unreadCount","sort","_c$unreadCount2","user","_selectedChat$propert","_selectedChat$seller","_selectedChat$buyer","borderBottom","level","letterSpacing","_Input","Search","allowClear","spinning","_Alert","type","_List","itemLayout","dataSource","renderItem","_chat$property4","_chat$property5","_chat$property6","propertyPhoto","photos","arr","JSON","parse","normalizePhotos","startsWith","Item","cursor","Meta","_Avatar","size","textOverflow","description","_selectedChat$seller2","_selectedChat$seller3","_selectedChat$seller4","sellerAvatar","flexShrink","lastName","_Tag","textDecoration","_selectedChat$propert4","preventDefault","phone","legalCheck","PropertySafetyOutlined"],"sourceRoot":""}